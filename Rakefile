require "yaml"

def notice
  "// This file was generated by the 'generate' Rake task\n\n"
end

def package
  "package htmlwriter\n\n"
end

def write_header(file)
  file << notice
  file << package
end

def create_elements_go_file(elements)
  elements_go_file = File.open("gen_elements.go", "w") do |f|
    write_header(f)

    elements.each do |el|
      func = <<FUNC
func (w *HtmlWriter) #{el.capitalize}(attrs Attrs, innerHtml func()) {
\tw.WriteNormalElement("#{el}", attrs, innerHtml)
}

FUNC

      f << func

      func_ = <<FUNC
func (w *HtmlWriter) #{el.capitalize}_(innerHtml func()) {
\tw.WriteNormalElement("#{el}", nil, innerHtml)
}

FUNC

      f << func_
    end
  end
end

def create_void_elements_go_file(elements)
  void_elements_go_file = File.open("gen_void_elements.go", "w") do |f|
    write_header(f)

    elements.each do |el|
      func = <<FUNC
func (w *HtmlWriter) #{el.capitalize}(attrs Attrs) {
\tw.WriteVoidElement("#{el}", attrs)
}

FUNC

      f << func

      func_ = <<FUNC
func (w *HtmlWriter) #{el.capitalize}_() {
\tw.WriteVoidElement("#{el}", nil)
}

FUNC

      f << func_
    end
  end
end

def create_input_elements_go_file(input_types)
  input_elements_go_file = File.open("gen_input_elements.go", "w") do |f|
    write_header(f)

    input_types.each do |type|
      func = <<FUNC
func (w *HtmlWriter) #{method_name_from_type(type)}(attrs Attrs) {
\tattrs["type"] = "#{type}"
\tw.Input(attrs)
}

FUNC

      f << func

      func_ = <<FUNC
func (w *HtmlWriter) #{method_name_from_type(type)}_() {
\tw.Input(Attrs{"type": "#{type}"})
}

FUNC

      f << func_
    end
  end
end

def method_name_from_type(type)
  type.split("-").map { |str| str.capitalize }.join("") << "Input"
end

def create_text_only_elements_go_file(elements)
  text_only_elements_go_file = File.open("gen_text_only_elements.go", "w") do |f|
    write_header(f)

    elements.each do |el|
      func = <<FUNC
func (w *HtmlWriter) #{el.capitalize}(attrs Attrs, formatStr string, a ...interface{}) {
\tw.WriteNormalElement("#{el}", attrs, w.RawTextF(formatStr, a...))
}

FUNC

      f << func

      func_ = <<FUNC
func (w *HtmlWriter) #{el.capitalize}_(formatStr string, a ...interface{}) {
\tw.WriteNormalElement("#{el}", nil, w.RawTextF(formatStr, a...))
}

FUNC

      f << func_
    end
  end
end

desc "Generate go file with elements"
task :generate do
  elements = YAML.load_file("elements.yml")
  create_elements_go_file(elements["non-void"])
  create_void_elements_go_file(elements["void"])
  create_input_elements_go_file(elements["inputs"])
  create_text_only_elements_go_file(elements["text"])
end
